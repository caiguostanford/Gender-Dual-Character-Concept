---
title: "Study 3"
author: "Cai Guo"
date: "11/12/2017"
output: html_document
---

#load and clean up data
```{r message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lmerTest)
library(car)
library(lme4)
library(BayesFactor)
library(gridExtra)
dt <- read.csv("~/Desktop/Stanford/Dual Character Concepts/Dual Character Concept Data/Study 3.csv")

#we filtered out those who didn't not answer the attention check question correctly
dt = dt %>%
  filter(Filter == 1)
```

#Demographics
```{r}
#1 = Female, 2 = Male, 3 = Other
prop.table(table(dt$ParticipantGender))
#Age
summary(dt$Age)
#Turns out one participant did not provide their age but instead put an irrelevant word -- we did the following procedure to eliminate this to calculate average age and the age range:
dt$Age = as.numeric(as.character(dt$Age))
summary(dt$Age)
```

#clean up and reformat the dataset (into long form)
```{r}
dt_tidy = dt %>%
  mutate(index=rownames(dt)) %>%
  gather(variable, value, N.Artist:M.Woman) %>%
  group_by(index) %>%
  separate(variable, into=c("Statement", "Concept"))

dt_tidy$Statement = as.factor(dt_tidy$Statement)
levels(dt_tidy$Statement)[levels(dt_tidy$Statement)=="N"] <- "Nonmember"
levels(dt_tidy$Statement)[levels(dt_tidy$Statement)=="M"] <- "Member"
```

#Compare Man and Woman to determine how to conduct subsequent analyses. 

```{r}
#Since the study is a within-subject design, we treat "subject" (known as index in the model) as a random effect. Moreover, since there was only one item in Man and Woman respectively, we do not include specific item as a random effect [such modeling isn't possible], but will do so for later analyses where dual-character and control concepts are involved. 

#interaction
lmg = lmer(value~Concept*Statement+(1|index), data = subset(dt_tidy, Concept == "Man"|Concept == "Woman"))
lmerTest::anova(lmg)
summary(lmg)

#main effect
lmgc = lmer(value~Concept+(1|index), data = subset(dt_tidy, Concept == "Man"|Concept == "Woman"))
lmerTest::anova(lmgc)
summary(lmgc)
```

The results showed that there was no significant interaction between gender and statement but there was a significant main effect of gender such that Man, regardless of statement type, received higher ratings than Woman. Therefore, we will treat the two items separately rather than combining them into a single category "gender" in the subsequent analyses. 

##Graph comparing "Man" and "Woman"
```{r message=FALSE, warning=FALSE, echo=FALSE}
sem <- function(x) {sd(x, na.rm=TRUE) / sqrt(length(x))}

ci <- function(x) {qt(.975, df=length(x)-1)*sem(x)}

agender = subset(dt_tidy, Concept == "Man"|Concept == "Woman") %>%
  group_by(Concept, Statement) %>%
  summarise(Mean = mean(value,na.rm=T),
            se = ci(value),
            upper = Mean + se,
            lower = Mean - se)

ggplot(agender,aes(x=Concept, y=Mean, fill=Statement, label = round(Mean, digits=2))) +
  geom_bar(position="dodge", stat="identity", col="black") + scale_fill_manual(values=c("grey", "white")) +
  geom_errorbar(   aes( ymax=upper, ymin=lower ) , 
                     		width   =.25,
	                    	linetype="solid", position=position_dodge(.9)
	                    	) + 
  theme_bw() + ggtitle("Ratings of Statements by Concept and Statement Type") + geom_text(size = 3, position = position_dodge(width=.9), vjust=5)
```

#Categorize the specific concepts into dual-character concepts, control concepts, Man, and Woman.

```{r}
dv = within(dt_tidy, {Type = ifelse(Concept %in% c("Artist", "Criminal", "Love", "Friend", "Mentor", "Comedian", "Minister", "Theory", "Boyfriend", "Argument"), "DualCharacter", ifelse(Concept %in% c("Rustling", "Welder", "Catalog", "Chair", "Firefighter", "Uncle", "Cashier", "Stroller", "Obituary", "Cousin"), "Control", ifelse(Concept=="Man", "Man", "Woman") ))})

dv$Type = as.factor(dv$Type)
```

#Test whether there were significant main effects of Concept Type and Statement Type and whether there was a significant interaction between them
```{r}
dv$Type = relevel(dv$Type, ref="Man")
dv$Statement = relevel(dv$Statement, ref="Member")

#Interaction
lm = lmer(value~Type*Statement+(1|Concept)+(1|index), dv)
lmerTest::anova(lm)
summary(lm)

#Main effect of Concept Type
lm1 = lmer(value~Type+(1|Concept)+(1|index), dv)
lmerTest::anova(lm1)
summary(lm1)

#Main effect of Statement Type
lm2 = lmer(value~Statement+(1|Concept)+(1|index), dv)
lmerTest::anova(lm2)
summary(lm2)
```

#Compare Man, Dual-Character Concepts, and Control Concepts
```{r}
#omnibus analysis for the Dual-Character, Man, and Control
lm33 = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, (Type == "Control"| Type == "Man"|Type == "DualCharacter")))
lmerTest::anova(lm33)
summary(lm33)
```

#Compara Dual-Character Concepts and Man
```{r}
#Compare dual and man (we are not interested in whether Statement Type alone had a main effect because this doesn't concern the differences between the types of concepts -- this applies to all of the subsequent comparisons between different types of concepts)

#Interaction
lmdm = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, Type == "DualCharacter"|Type == "Man"))
lmerTest::anova(lmdm)
summary(lmdm)

#main effect of concept type

lmdm1 = lmer(value~Type+(1|Concept)+(1|index), data = subset(dv, Type == "DualCharacter"|Type == "Man"))
lmerTest::anova(lmdm1)
summary(lmdm1)

#examine only for dual-character
lmd = lmer(value~Statement+(1|Concept)+(1|index), data = subset(dv, Type == "DualCharacter"))
lmerTest::anova(lmd)
summary(lmd)

#examine only for man
lmm = lmer(value~Statement+(1|index), data = subset(dv, Type == "Man"))
lmerTest::anova(lmm)
summary(lmm)

#examine only for member statement
lmmem1 = lmer(value~Type+(1|index)+(1|Concept), data = subset(dv, (Type == "DualCharacter"|Type == "Man") &(Statement == "Member")))
lmerTest::anova(lmmem1)
summary(lmmem1)

#examine only for non-member statement
lmnem1 = lmer(value~Type+(1|index)+(1|Concept), data = subset(dv, (Type == "DualCharacter"|Type == "Man") &(Statement == "Nonmember")))
lmerTest::anova(lmnem1)
summary(lmnem1)
```
Regardless of statement type, there was no difference in ratings between man and dual-character concepts, F(1,9) = 0.73, p = .42. However, there was a marginally significant interaction between concept and statement F(1,3075) = 3.80, p = .051, such that for man, non-member statement was rated significantly higher than the member statement t(146) = 2.16, p = .03 , but there was no significant difference between the two statements for dual-character concepts, t(2792) = 0.31, p = .76. We also examined this interaction in terms of statement type. Specifically, Dual-Character concepts and Man did not differ in ratings of Member statements, t(9) = 1.42, p = .20, and they did not differ significant in ratings of Nonmember statements, t(9) = 0.14, p = .89. Therefore, the two concept types did not differ in either member or non-member statements but the within concept difference between member and non-member statements is significant for Man but not significant for Dual-Character concepts. 

#Compare Control and Man
```{r}
#interaction
lmcm = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, Type == "Control"| Type == "Man"))
lmerTest::anova(lmcm)
summary(lmcm)

#main effect
lmcm1 = lmer(value~Type+(1|Concept)+(1|index), data = subset(dv, Type == "Control"| Type == "Man"))
lmerTest::anova(lmcm1)
summary(lmcm1)

#examine only for control
lmcmd = lmer(value~Statement+(1|index), data = subset(dv, Type == "Control"))
lmerTest::anova(lmcmd)
summary(lmcmd)

#examine only for member statement
lmmem2 = lmer(value~Type+(1|index)+(1|Concept), data = subset(dv, (Type == "Control"|Type == "Man") &(Statement == "Member")))
lmerTest::anova(lmmem2)
summary(lmmem2)

#examine only for non-member statement
lmnem2 = lmer(value~Type+(1|index)+(1|Concept), data = subset(dv, (Type == "Control"|Type == "Man") &(Statement == "Nonmember")))
lmerTest::anova(lmnem2)
summary(lmnem2)
```

There was a significant main effect of concept type, F(1,9) = 9.49, p = .01, such that regardless of statement type, the ratings for "Man" were higher than those for control concepts, t(9) = 3.08, p = .01. More importantly, there was also a significant interaction between concept and statement F(1, 3075) = 14.40, p <.001, such that for man, non-member statements were rated significantly higher than member statements t(146) = 2.16, p = .03, but for control concepts, non-member statements were rated significantly lower than member statements, t(2792) = -5.74, p < .001. Examining the interaction in terms of statement type, we found that Control concepts and Man did not differ significantly in member statements, but Man had significantly higher ratings in Nonmember statements than did control concepts, t(9) = -4.21, p = .002.

#Compare Woman, Dual-Character Concepts, and Control Concepts
```{r}
#omnibus analysis for the Dual-Character, Woman, and Control
lm44 = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, (Type == "Control"| Type == "Woman"|Type == "DualCharacter")))
lmerTest::anova(lm44)
summary(lm44)
```

#Compare Dual-Character Concepts and Woman
```{r}
#interaction
lmdw = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, Type == "DualCharacter"| Type == "Woman"))
lmerTest::anova(lmdw)
summary(lmdw)

#main effect
lmdw1 = lmer(value~Type+(1|Concept)+(1|index), data = subset(dv, Type == "DualCharacter"| Type == "Woman"))
lmerTest::anova(lmdw1)
summary(lmdw1)

#examine only for Woman (already examined dual-character in the above section)
lmw = lmer(value~Statement+(1|index), data = subset(dv, Type == "Woman"))
lmerTest::anova(lmw)
summary(lmw)
```

The results showed that there was no significant interaction between Dual-Character Concepts and Woman. However, there was a significant main effect of concept type, F(1,9) = 6.49, p = .03 such that Woman had significantly lower ratings regardless of statement type than Dual-Character Concepts, t(9) = -2.55, p = .03.

#Compare Control and Woman
```{r}
#interaction
lmcw = lmer(value~Type*Statement+(1|Concept)+(1|index), data = subset(dv, Type == "Control"| Type == "Woman"))
lmerTest::anova(lmcw)
summary(lmcw)

#main effect
lmcw1 = lmer(value~Type+(1|Concept)+(1|index), data = subset(dv, Type == "Control"| Type == "Woman"))
lmerTest::anova(lmcw1)
summary(lmcw1)
```

Control concepts were not different from woman -- no significant main effect of concept type or interaction between concept type and statetment type. 

#General Graph
```{r message=FALSE, warning=FALSE, echo=FALSE}
sem <- function(x) {sd(x, na.rm=TRUE) / sqrt(length(x))}

ci <- function(x) {qt(.975, df=length(x)-1)*sem(x)}

aggv3 <- dv %>%
  group_by(Type, Statement) %>%
  summarise(Mean = mean(value,na.rm=T),
            se = ci(value),
            upper = Mean + se,
            lower = Mean - se)

ggplot(aggv3,aes(x=Type, y=Mean, fill=Statement, label = round(Mean, digits=2))) +
  geom_bar(position="dodge", stat="identity", col="black") + scale_fill_manual(values=c("grey", "white")) +
  geom_errorbar(   aes( ymax=upper, ymin=lower ) , 
                     		width   =.25,
	                    	linetype="solid", position=position_dodge(.9)
	                    	) + 
  theme_bw() + ggtitle("Ratings of Statements by Concept and Statement Type") + geom_text(size = 3, position = position_dodge(width=.9), vjust=10)
```


##Using Bayesian Methods to examine if models that treat Man/Woman as the same as Dual-Character Cocenpts are better than models that treat Man/Woman as the same as Control Concepts.
```{r }
#creating new Type variables to prepare for the BayesFactor analyses.
##Type1 is for the model A where Dual-Character and Man are treated as the same
##Type2 is for the model B where Control and Man are treated as the same
##Type3 is for the model C where Dual-Character and Woman are treated as the same
##Type4 is for the model D where Control and Woman are treated as the same

dv_d = dv %>%
  mutate(Type1 = recode(Type, "c('DualCharacter', 'Man') = 'DM'"), Type2 = recode(Type, "c('Control', 'Man') = 'CM'"), Type3 = recode(Type, "c('DualCharacter', 'Woman') = 'DW'"), Type4 = recode(Type, "c('Control', 'Woman') = 'CW'"))

dv_d$value = as.numeric(dv_d$value)

#bf1 is the all-different model where Dual-Character, Control, Man, and Woman are all separate
bf1 = lmBF(value~Type+Statement+Type*Statement, data = as.data.frame(dv_d), whichRandom = c("Concept", "index"))
bf1

#bf2 is the model A where man = dual character but not control or woman

bf2 = lmBF(value~Type1+Statement+Type1*Statement, data = as.data.frame(dv_d), whichRandom = c("Concept", "index"))
bf2

#compare model A and the all-different model
bf_tests = c(bf1, bf2)
bf_tests

#since bf2's Bayes factor is bigger than that of bf2, we put bf2's factor as the numerator and bf1's factor as the denominator to see how much bigger bf2 factor is than bf1 factor.
bf_tests[2]/bf_tests[1]

#bf3 is the model B where man = control but not dual-character or woman
bf3 = lmBF(value~Type2+Statement+Type2*Statement, data = as.data.frame(dv_d), whichRandom = c("Concept", "index"))
bf3

#compare model B and the all-different model
bf_tests2 = c(bf1, bf3)
bf_tests2
#since bf1's Bayes factor is bigger than that of bf3, we put bf1's factor as the numerator and bf3's factor as the denominator to see how much bigger bf1 factor is than bf3 factor.
bf_tests2[1]/bf_tests2[2] 


#now we directly compare the bf2 and bf3
bf_tests3 = c(bf2, bf3)
bf_tests3
#since bf2's Bayes factor is bigger than that of bf3, we put bf2's factor as the numerator and bf3's factor as the denominator to see how much bigger bf2's factor is than bf3's factor.
bf_tests3[1]/bf_tests3[2]

#bf4 is the model C where woman = dual but not control or man
bf4 = lmBF(value~Type3+Statement+Type3*Statement, data = as.data.frame(dv_d), whichRandom = c("Concept", "index"))
bf4

#compare model C and all-different model
bf_tests4 = c(bf1, bf4)
bf_tests4
bf_tests4[1]/bf_tests4[2]

#bf5 is the model D where woman = control but not dual-character or man
bf5 = lmBF(value~Type4+Statement+Type4*Statement, data = as.data.frame(dv_d), whichRandom = c("Concept", "index"))
bf5

#compare model D and the all-different model
bf_tests5 = c(bf1, bf5)
bf_tests5
bf_tests5[1]/bf_tests5[2]

#compare models C and D
bf_tests6 = c(bf4, bf5)
bf_tests6
bf_tests6[2]/bf_tests6[1]
```
For Man:

The results from the Bayes Factor analayses revealed that the model A where Man and dual-character are the same is preferred to the all-different model by a Bayes factor of 1.73. In contrast, the model B where control concepts and Man are the same is inferior to the all-different model by a Bayes factor of 2.525e+16. The direct comparison between model A and model B revealed that model A is preferred to model B by a Bayes factor of 4.388e+16, suggesting that Man is much closer to dual-character concepts than to control concepts. 

For Woman:

The results from the Bayes Factor analayses revealed that the model C where Woman and dual-character are the same is inferior to the all-different model by a Bayes factor of 5.696e+6. To a much smaller extent, the model D where control concepts and Woman are the same is inferior to the all-different model by a Bayes factor of 1501. The direct comparison between model C and model D revealed that model D is preferred to model C by a Bayes factor of 3795, suggesting that Woman is more similar to control concepts than to dual-character concepts. 

##Distribution
```{r}
dv_s = dv %>%
  filter(Statement  == "Member")
#For Man

g1=ggplot(subset(dv_s, Type == "Man"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Man - Member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))

#For Woman
g2=ggplot(subset(dv_s, Type == "Woman"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Woman - Member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))


#For Dual Character
g3=ggplot(subset(dv_s, Type == "DualCharacter"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Dual-Character - Member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))


#For Control
g4=ggplot(subset(dv_s, Type == "Control"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Control - Member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))


grid.arrange(g1, g2, g3, g4, ncol=2)

dv_n = dv %>%
  filter(Statement == "Nonmember")

#For Man
g5=ggplot(subset(dv_n, Type == "Man"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Man - Non-member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05)) 


#For Woman
g6=ggplot(subset(dv_n, Type == "Woman"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Woman - Non-member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05)) 


#For Dual Character
g7=ggplot(subset(dv_n, Type == "DualCharacter"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Dual-Character - Non-member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))


#For Control
g8=ggplot(subset(dv_n, Type == "Control"), aes(value)) +
  geom_histogram(breaks=seq(0,7, by=1), aes(y = (..count..)/sum(..count..)),
    stat = "count",
                 col="black",
                 fill="grey") +
  labs(x="Rating", y="Percentage") + scale_x_discrete(limits=c(1,2,3,4,5,6,7)) + ggtitle("Control - Non-member Statement") + scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35, by=0.05))
  
grid.arrange(g5, g6, g7, g8, ncol=2)
```


